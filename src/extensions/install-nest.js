'use strict'

module.exports = (toolbox) => {
  toolbox.installNest = async ({ projectScope, projectName }) => {
    const {
      system,
      print: { error, success, muted },
    } = toolbox

    muted('Installing Nest...')
    try {
      await system.run('npm install -g @nestjs/cli')
      if (projectScope) {
        await system.run(
          `nest new @${projectScope}/${projectName} --skip-git --package-manager npm`
        )
        await system.run(
          `mv @${projectScope}/${projectName} ./ && rm -d @${projectScope}`
        )
      } else {
        await system.run(
          `nest new ${projectName} --skip-git --package-manager npm`
        )
      }
      await system.run(`cd ./${projectName} && git init -b main`)
      await system.run(
        `echo "This is a sample project generated by @nestjs/cli. You can extend it using the same CLI. For information on commands run" "\`nest --help\`" > ./${projectName}/README.md`
      )
    } catch (err) {
      error(`An error has occurred while installing Nest: ${err}`)
    }

    success('Nest installation completed successfully')
  }
}
